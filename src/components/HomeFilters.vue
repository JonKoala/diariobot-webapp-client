<template>
  <v-container>
    <v-layout row justify-space-around>
      <v-flex xs2>
        <base-date-picker v-model="dataStart" label="Data Inicial" hide-details></base-date-picker>
      </v-flex>
      <v-flex xs2>
        <base-date-picker v-model="dataEnd" label="Data Final" hide-details></base-date-picker>
      </v-flex>
      <v-flex xs2>
        <v-layout row>
          <v-flex>
            <base-debounce-input v-model="corpo" v-bind:disabled="!isWithinDateLimit" clearable label="Busca Interna" append-icon="search" hide-details></base-debounce-input>
          </v-flex>
          <base-icon-button v-show="!isWithinDateLimit" v-bind:tooltip="`Período acima dos ${DateLimitForTextualSearch} dias permitidos para busca textual`" cursor="default" color="red darken-4" top flat>
            error_outline
          </base-icon-button>
        </v-layout>
      </v-flex>
      <v-flex xs2>
        <base-debounce-input v-model="valorMin" v-bind:mask="moneyMask" return-masked-value clearable label="Valor Mínimo" append-icon="attach_money" hide-details></base-debounce-input>
      </v-flex>
      <v-flex xs2>
        <base-debounce-input v-model="valorMax" v-bind:mask="moneyMask" return-masked-value clearable label="Valor Máximo" append-icon="attach_money" hide-details></base-debounce-input>
      </v-flex>
    </v-layout>
    <v-layout row justify-space-around>
      <v-flex xs2>
        <v-autocomplete v-model="tipo" v-bind:items="tipos" label="Tipo" clearable append-icon="tune" hide-details></v-autocomplete>
      </v-flex>
      <v-flex xs2>
        <v-autocomplete v-model="orgao" v-bind:items="orgaos" label="Orgão" clearable append-icon="tune" hide-details></v-autocomplete>
      </v-flex>
      <v-flex xs2>
        <v-autocomplete v-model="suborgao" v-bind:items="suborgaos" label="Jurisdicionado" clearable append-icon="tune" hide-details></v-autocomplete>
      </v-flex>
      <v-flex xs2>
        <v-autocomplete v-model="fonte" v-bind:items="fontes" label="Fonte" clearable append-icon="tune" hide-details></v-autocomplete>
      </v-flex>
      <v-flex xs2>
        <v-autocomplete v-model="classe" v-bind:items="classes" item-text="nome" item-value="id" label="Tema" clearable append-icon="tune" hide-details></v-autocomplete>
      </v-flex>
    </v-layout>
  </v-container>
</template>

<script>
import { mapGetters } from 'vuex'

import Constants from 'services/constants.service'
import PublicacaoFonteSchema from 'services/publicacao.fonte.schema'

import { QUERY, VIEW_HOME } from 'store/namespaces'
import {
  SET_CLASSE, SET_CORPO, SET_DATA_END, SET_DATA_START, SET_FONTE,
  SET_ORGAO, SET_SUBORGAO, SET_TIPO, SET_VALOR_MAX, SET_VALOR_MIN
} from 'store/mutation.types'

import BaseDebounceInput from 'components/BaseDebounceInput'
import BaseDatePicker from 'components/BaseDatePicker'
import BaseIconButton from 'components/BaseIconButton'

export default {
  name: 'HomeFilters',
  components: {
    BaseDatePicker,
    BaseDebounceInput,
    BaseIconButton
  },
  data () {
    return {
      moneyMask: '############'
    }
  },
  computed: {
    ...mapGetters([
      'classes',
      'orgaos',
      'suborgaos',
      'tipos'
    ]),
    ...mapGetters(`${VIEW_HOME}/${QUERY}`, [
      'isWithinDateLimit'
    ]),
    classe: {
      get () { return this.getValue('classe') },
      set (value) { this.setValue(SET_CLASSE, value) }
    },
    corpo: {
      get () { return this.getValue('corpo') },
      set (value) { this.setValue(SET_CORPO, value) }
    },
    dataEnd: {
      get () { return this.getValue('dataEnd') },
      set (value) { this.setValue(SET_DATA_END, value) }
    },
    dataStart: {
      get () { return this.getValue('dataStart') },
      set (value) { this.setValue(SET_DATA_START, value) }
    },
    fonte: {
      get () { return this.getValue('fonte') },
      set (value) { this.setValue(SET_FONTE, value) }
    },
    fontes () {
      return this.$store.getters['fontes'].map(f => { return { text: PublicacaoFonteSchema[f], value: f } })
    },
    orgao: {
      get () { return this.getValue('orgao') },
      set (value) { this.setValue(SET_ORGAO, value) }
    },
    suborgao: {
      get () { return this.getValue('suborgao') },
      set (value) { this.setValue(SET_SUBORGAO, value) }
    },
    tipo: {
      get () { return this.getValue('tipo') },
      set (value) { this.setValue(SET_TIPO, value) }
    },
    valorMax: {
      get () { return this.castString(this.getValue('valorMax')) },
      set (value) { this.setValue(SET_VALOR_MAX, this.castNumber(value)) }
    },
    valorMin: {
      get () { return this.castString(this.getValue('valorMin')) },
      set (value) { this.setValue(SET_VALOR_MIN, this.castNumber(value)) }
    },
    DateLimitForTextualSearch () {
      return Constants.DateLimitForTextualSearch
    }
  },
  methods: {
    castNumber (value) {
      return (value) ? Number(value) : null
    },
    castString (value) {
      return (value) ? '' + value : null
    },
    getValue (getter) {
      return this.$store.getters[`${VIEW_HOME}/${QUERY}/${getter}`]
    },
    setValue (mutation, value) {
      this.$store.commit(`${VIEW_HOME}/${QUERY}/${mutation}`, value)
      this.$emit('input')
    }
  }
}
</script>
